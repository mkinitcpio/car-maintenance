<section class="cm-table">
  <cm-table-panel [columnSchemas]="tableConfig().columnSchemas"
                  *ngIf="tableConfig().panel"
                  [selectedRowsCount]="selectedRows.selected.length"
                  (add)="add.emit()"
                  (move)="onMove()"
                  (exportToPDF)="onExportToPDF()"
                  (exportToCSV)="onExportToCSV(tableHeader, table)"
                  (onVisibilityChanged)="onColumnVisibilityChanged($event)">
  </cm-table-panel>
  <section class="cm-table__table-section">
    <table #table class="cm-table__table">
      <thead class="cm-table__head">
        <tr #tableHeader class="cm-table__head-row">
          <th class="cm-table__head-cell cm-table--column-select"
              *ngIf="tableConfig().actions.selectable"
          >
            <mat-checkbox class="checkbox cm-table__checkbox"
                          [checked]="allRowSelected"
                          disableRipple="true"
                          (change)="onAllRowToggle($event)"
                          [indeterminate]="someRowSelected"
            >
            </mat-checkbox>
          </th>
          @for (schema of columnSchemas(); track $index) {
              <th [attr.data-csv]="schema.name | translate"
                  *ngIf="schema.visible" class="cm-table__head-cell cm-table--column-{{schema.key}} cm-table__head-cell--{{schema.key}}"
              >
                {{schema.name | translate}}
              </th>
          }
        </tr>
      </thead>
      <tbody class="cm-table__body">
        @for (row of rows(); track row.id) {
          <tr class="cm-table__row"
              [cdkContextMenuTriggerFor]="contextMenu"
              [cdkContextMenuTriggerData]="{$implicit: row}"
              [class.cm-table__row--selected]="selectedRows.isSelected(row.id)"
              (click)="onSelectionChange(row.id)"
          >
            <td class="cm-table__cell cm-table--column-select"
                *ngIf="tableConfig().actions.selectable"
            >
              <mat-checkbox class="cm-table__checkbox"
                            (click)="$event.stopPropagation()"
                            [checked]="selectedRows.isSelected(row.id)"
                            (change)="onSelectionChange(row.id)"
                            disableRipple="true">
              </mat-checkbox>
            </td>
            @for (schema of columnSchemas(); track $index) {
              <td *ngIf="schema.visible"
                  class="cm-table__cell cm-table--column-{{schema.key}} cm-table__cell--{{schema.key}}"
                  [ngSwitch]="schema.type"
              >
                <cm-cell-note *ngSwitchCase="'note'" [value]="row[schema.key]"></cm-cell-note>
                <cm-cell-date *ngSwitchCase="'date'" [value]="row[schema.key]"></cm-cell-date>
                <cm-cell-cost *ngSwitchCase="'cost'" [value]="row[schema.key]"></cm-cell-cost>
                <cm-cell-mileage *ngSwitchCase="'mileage'" [value]="row[schema.key]"></cm-cell-mileage>
                <cm-cell-text *ngSwitchDefault [value]="row[schema.key]"></cm-cell-text>
              </td>
            }
          </tr>
        }
      </tbody>
    </table>
  </section>
</section>

<ng-template #contextMenu let-row>
  <div cdkMenu>
    <button *ngIf="selectedRows.selected.length <= 1" class="example-menu-item" (click)="onEdit(row.id)" cdkMenuItem>Edit</button>
    <button class="example-menu-item" (click)="onMove()" cdkMenuItem>Move</button>
    <button class="example-menu-item" (click)="onDelete(row)" cdkMenuItem>Delete</button>
  </div>
</ng-template>


